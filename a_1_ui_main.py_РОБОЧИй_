"""
a_1_ui_main.py
Головний UI: складає разом усі блоки.
"""

import re
import os
import gradio as gr
from typing import Tuple

from a_1_1_ui_text_input import create_text_input_block
from a_1_2_ui_speakers import create_speaker_block
from a_1_3_ui_controls import create_controls_block, SAVE_CHOICES
from a_1_4_ui_output import create_output_block
from a_1_5_ui_syntax_help import create_syntax_help_block
from a_1_6_ui_settings_save import create_settings_save_block


DEFAULT_VISIBLE = 3  # кількість спікерів за замовчуванням


def create_multi_dialog_tab(speaker_choices: list) -> Tuple:
    """
    Створює вкладку 'Multi Dialog' з усіма компонентами.
    
    Returns:
        (text_input, file_input, voice_components, speed_components,
         btn_start, save_option, ignore_speed_chk,
         output_audio, part_slider, autoplay_chk,
         timer_text, start_time_text, end_time_text, est_end_time_text,
         remaining_time_text, parts_progress,
         accordion_refs,
         save_buttons_inner, save_buttons_top)
    """
    
    # Блок 1: Введення тексту
    text_input, file_input = create_text_input_block()
    
    # Блок 2: Спікери (акордеони)
    voice_components, speed_components, accordion_refs = create_speaker_block(speaker_choices)
    
    # Блок 3: Керування (кнопка запуску, опції)
    btn_start, save_option, ignore_speed_chk = create_controls_block()
    
    # Блок 4: Вивід (аудіо, слайдер, таймери)
    (output_audio, part_slider, autoplay_chk,
     timer_text, start_time_text, end_time_text, est_end_time_text,
     remaining_time_text, parts_progress) = create_output_block()
    
    # Блок 5: Синтаксис
    create_syntax_help_block()
    
    # Блок 6: Збереження/завантаження
    save_buttons_inner, save_buttons_top = create_settings_save_block()
    
    return (
        text_input, file_input,
        voice_components, speed_components,
        btn_start, save_option, ignore_speed_chk,
        output_audio, part_slider, autoplay_chk,
        timer_text, start_time_text, end_time_text, est_end_time_text,
        remaining_time_text, parts_progress,
        accordion_refs,
        save_buttons_inner, save_buttons_top
    )


def setup_text_change_handlers(
    text_input: gr.Textbox,
    file_input: gr.File,
    voice_components: list,
    speed_components: list,
    accordion_refs: list
):
    """
    Налаштовує обробники зміни тексту.
    Зараз це заглушка — логіка приховування вимкнена.
    """
    pass
