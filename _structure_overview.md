# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É

## üìÅ –†—ñ–≤–Ω—ñ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó

### üé® **–†—ñ–≤–µ–Ω—å 1: UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏** (`a_1_*`)
–ö–æ–∂–µ–Ω —Ñ–∞–π–ª = –æ–¥–∏–Ω UI-–±–ª–æ–∫, –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–π –≤—ñ–¥ —ñ–Ω—à–∏—Ö:

- **`a_1_1_ui_text_input.py`**
  - `create_text_input_block()` ‚Üí (textbox, file)

- **`a_1_2_ui_speakers.py`**
  - `create_speaker_block(choices)` ‚Üí (voices[], speeds[], accords[])

- **`a_1_3_ui_controls.py`**
  - `create_controls_block()` ‚Üí (btn_start, save_option, ignore_speed)

- **`a_1_4_ui_output.py`**
  - `create_output_block()` ‚Üí (audio, slider, timers...)

- **`a_1_5_ui_syntax_help.py`**
  - `create_syntax_help_block()` ‚Üí (markdown —Å–ø–æ–π–ª–µ—Ä)

- **`a_1_6_ui_settings_save.py`**
  - `create_settings_save_block()` ‚Üí (download_btn, save_btn, load_btn) x2

- **`a_1_ui_main.py`** ‚≠ê (–ú–û–ù–¢–ê–ñ–ù–ò–ö)
  - `create_multi_dialog_tab()` ‚Üí –∑–±–∏—Ä–∞—î –≤—Å—ñ –±–ª–æ–∫–∏
  - `setup_text_change_handlers()` ‚Üí –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∑–º—ñ–Ω–∏ —Ç–µ–∫—Å—Ç—É

---

### ‚öôÔ∏è **–†—ñ–≤–µ–Ω—å 2: –û–±—Ä–æ–±–∫–∏ & –õ–æ–≥—ñ–∫–∞** (`a_2_-_a_7_`)

- **`a_2_synthesis.py`**
  - `_synthesize_chunk()` ‚Äî —Å–∏–Ω—Ç–µ–∑ –∑ fallback-–∞–º–∏
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: `a_6_*`, `a_7_*`

- **`a_3_sfx_engine.py`**
  - `get_sfx_config()` ‚Äî —á–∏—Ç–∞–Ω–Ω—è sfx.yaml
  - `_load_and_process_sfx()` ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è SFX –∑ –æ–±—Ä–æ–±–∫–æ—é
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: numpy, scipy, soundfile

- **`a_4_progress_logic.py`**
  - `estimate_remaining()` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑ —á–∞—Å—É
  - `get_elapsed_str()` ‚Äî —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: `a_7_utils.format_hms`

- **`a_5_speaker_logic.py`**
  - `parse_script_events()` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–≥—ñ–≤ `#gN`, `#sfx`
  - `_compute_speed_effective()` ‚Äî –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: `a_6_text_processing`

- **`a_6_text_processing.py`**
  - `normalize_text()` ‚Äî –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —é–Ω—ñ–∫–æ–¥—É
  - `split_to_parts()` ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è –ø–æ —Ç–æ–∫–µ–Ω–∞–º
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: albert-base-v2 tokenizer (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

- **`a_7_utils.py`**
  - `NoProgress` ‚Äî –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞
  - `_safe_float()`, `_read_text_source()`, `_should_use_single_voice()`
  - `format_hms()` ‚Äî —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: –Ω—ñ—á–æ–≥–æ

---

### üéº **–†—ñ–≤–µ–Ω—å 3: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è & –û–±—Ä–æ–±–Ω–∏–∫–∏** (`a_8_*`)

- **`a_8_pipeline.py`** ‚≠ê (–ë–ê–¢–ß-–°–ò–ù–¢–ï–ó)
  - `batch_synthesize_dialog_events()` ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
  - –í–∏–∫–ª–∏–∫: text ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí —Å–∏–Ω—Ç–µ–∑/SFX ‚Üí —Ñ–∞–π–ª–∏ + UI-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: `a_2_*`, `a_3_*`, `a_4_*`, `a_5_*`, `a_7_*`

- **`a_8_1_event_handlers.py`**
  - `create_btn_start_handler()` ‚Äî –æ–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫—É
  - `create_export_settings_handler()` ‚Äî –µ–∫—Å–ø–æ—Ä—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
  - `create_save_to_default_handler()` ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ø–∞–ø–∫—É
  - `create_load_settings_handler()` ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —Ñ–∞–π–ª—É
  - `create_part_slider_handler()` ‚Äî –∑–º—ñ–Ω–∞ —Å–ª–∞–π–¥–µ—Ä–∞ —á–∞—Å—Ç–∏–Ω

- **`a_8_2_event_registration.py`** ‚≠ê (–†–ï–Ñ–°–¢–† –ü–û–î–Ü–ô)
  - `register_all_events()` ‚Äî –∑'—î–¥–Ω—É—î click/change –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∑ UI
  - –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥: `a_8_1_*`

---

### üöÄ **–†—ñ–≤–µ–Ω—å 4: –ó–∞–ø—É—Å–∫** (`a_9_*`)

- **`a_9_main.py`** ‚≠ê (–¢–û–ß–ö–ê –í–•–û–î–£)
  - `main()` ‚Äî —Å—Ç–≤–æ—Ä—é—î Gradio —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - –ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å:
    1. –°—Ç–≤–æ—Ä–∏—Ç–∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (`a_1_ui_main`)
    2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –∑–º—ñ–Ω
    3. –ó—ñ–±—Ä–∞—Ç–∏ —Å–ª–æ–≤–Ω–∏–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
    4. –†–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –≤—Å—ñ —Å–æ–±—ã—Ç–∏—è (`a_8_2_event_registration`)
    5. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `demo.queue().launch()`

---

## üîÑ –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç/—Ñ–∞–π–ª
    ‚Üì
–ù–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É "–†–æ–∑–ø–æ—á–∞—Ç–∏"
    ‚Üì
a_8_1_event_handlers.create_btn_start_handler()
    ‚Üì
a_8_pipeline.batch_synthesize_dialog_events()
    ‚îú‚îÄ a_5_speaker_logic.parse_script_events()
    ‚îú‚îÄ (–¥–ª—è –∫–æ–∂–Ω–æ—ó eventi:)
    ‚îÇ  ‚îú‚îÄ a_2_synthesis._synthesize_chunk() [–ò–õ–ò]
    ‚îÇ  ‚îî‚îÄ a_3_sfx_engine._load_and_process_sfx()
    ‚îú‚îÄ a_4_progress_logic.estimate_remaining()
    ‚îî‚îÄ yield (audio_file, updates...)
    ‚Üì
UI –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
```

---

## ‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ —Ñ–∞–π–ª–∞–º–∏

```
a_9_main.py (–≥–ª–∞–≤–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É)
‚îú‚îÄ‚îÄ a_1_ui_main.py
‚îÇ   ‚îú‚îÄ‚îÄ a_1_1_ui_text_input.py
‚îÇ   ‚îú‚îÄ‚îÄ a_1_2_ui_speakers.py
‚îÇ   ‚îú‚îÄ‚îÄ a_1_3_ui_controls.py
‚îÇ   ‚îú‚îÄ‚îÄ a_1_4_ui_output.py
‚îÇ   ‚îú‚îÄ‚îÄ a_1_5_ui_syntax_help.py
‚îÇ   ‚îî‚îÄ‚îÄ a_1_6_ui_settings_save.py
‚îÇ
‚îú‚îÄ‚îÄ a_8_pipeline.py
‚îÇ   ‚îú‚îÄ‚îÄ a_2_synthesis.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a_6_text_processing.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a_7_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ a_3_sfx_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ a_4_progress_logic.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a_7_utils.py
‚îÇ   ‚îú‚îÄ‚îÄ a_5_speaker_logic.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a_6_text_processing.py
‚îÇ   ‚îî‚îÄ‚îÄ a_7_utils.py
‚îÇ
‚îî‚îÄ‚îÄ a_8_2_event_registration.py
    ‚îî‚îÄ‚îÄ a_8_1_event_handlers.py
        ‚îú‚îÄ‚îÄ a_8_pipeline.py (–ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä)
        ‚îú‚îÄ‚îÄ a_3_sfx_engine.py
        ‚îî‚îÄ‚îÄ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ): a_8_1_event_handlers.py
```

---

## üéØ –Ø–∫ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏

### –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π UI-–±–ª–æ–∫:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ `a_1_7_ui_new_feature.py` –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é `create_new_block()`
2. –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –≤ `a_1_ui_main.py`
3. –î–æ–¥–∞—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–æ `create_multi_dialog_tab()`

### –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –æ–±—Ä–æ–±–Ω–∏–∫:
1. –î–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –≤ `a_8_1_event_handlers.py`
2. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –≤ `a_8_2_event_registration.py`

### –ó–º—ñ–Ω–∏—Ç–∏ –ª–æ–≥—ñ–∫—É —Å–∏–Ω—Ç–µ–∑—É:
1. –ó–º—ñ–Ω–∏—Ç–∏ `a_2_synthesis.py` –∞–±–æ `a_8_pipeline.py`
2. –Ü–º–ø–æ—Ä—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂–∞—Ç—å –∑–º—ñ–Ω–∏

---

## üìù –§–∞–π–ª–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ó–æ–≤–Ω—ñ —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É:**
- `app.py` ‚Äî –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏:
  - `synthesize(mode, text, speed, voice_name, progress)`
  - `prompts_list` ‚Äî —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å—ñ–≤
- `sfx.yaml` ‚Äî –∫–æ–Ω—Ñ—ñ–≥ SFX —Ñ–∞–π–ª—ñ–≤
- –∑–≤—É–∫–æ–≤—ñ —Ñ–∞–π–ª–∏ –¥–ª—è SFX

---

## üèÉ –ó–∞–ø—É—Å–∫

```bash
python a_9_main.py
```

–ê–±–æ –≤ –∫–æ–¥—ñ:
```python
from a_9_main import main
main()
```

---

**–ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—ñ—î—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏:**
‚úÖ –ö–æ–∂–µ–Ω —Ñ–∞–π–ª –º–∞—î –æ–¥–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å  
‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ  
‚úÖ –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ UI-–±–ª–æ–∫–∏  
‚úÖ –õ–µ–≥–∫–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è UI  
‚úÖ –Ø—Å–Ω–∞ —ñ—î—Ä–∞—Ä—Ö—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π  
‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
